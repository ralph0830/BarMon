## 📄 바몬 월드 전투 시스템 기획서 (prd_battle.md)

---

### 🔖 기본 개요

| 항목 | 설명 |
|------|------|
| 모듈명 | 바몬 전투 시스템 (Battle System) |
| 적용 대상 | PvE, PvP, 이벤트 전투, 보스전 등 모든 전투 컨텐츠 |
| 전투 타입 | 2 + 1 시스템 (메인 2마리 + 서포트 1마리), 1:1 또는 2:2 구조 |
| 플랫폼 | Flutter 기반 모바일 클라이언트 |

---

### ⚙️ 전투 기본 구조

- **출전 바몬**: 플레이어는 전투에 2마리의 바몬과 1마리의 서포트 바몬을 설정
- **전투 흐름**:
  1. 전투 시작: 바몬A 자동 출전
  2. 기본 공격은 자동
  3. 스킬 게이지 충전 시 스킬 사용 가능 (자동/수동)
  4. 스와이프 or 버튼을 통해 바몬A ↔ 바몬B 교체 (쿨타임 존재)
  5. 서포트 바몬은 조건 충족 시 자동 발동 (힐, 쉴드, 디버프 등)
  6. 필살기는 수동 발동 또는 자동 설정 가능
  7. 전투 종료: 승/패/획득 보상 정산

---

### 🧠 전투 인터랙션 요소

| 요소 | 설명 |
|------|------|
| 🌀 기본 공격 | 자동 수행, DPS 기반 평타 |
| 🧪 스킬 | 쿨타임 존재, 게이지 소비, 스킬 컷인 연출 포함 |
| 🔁 교체 | 스와이프 또는 버튼, 10초 쿨타임, 교체 시 효과 부여 가능 |
| 🧬 서포트 바몬 | 자동 발동, 회복/보호/버프/디버프 등 전투 보조 |
| 💥 필살기 | 게이지 Max 시 발동, 컷인 및 룰렛 기반 크리티컬 연출 포함 |
| 🎰 룰렛 시스템 | 필살기 또는 포획 시 등장, 성공/실패/크리티컬 결정 |

---

### 🤖 자동 전투 시스템

| 자동 범위 | 설정 가능 여부 |
|-----------|----------------|
| 기본 공격 | 항상 자동 |
| 스킬 사용 | 자동 / 수동 선택 가능 |
| 필살기 | 자동 / 수동 선택 가능 |
| 교체 | 수동 기본, 조건부 자동 (HP 30% 이하 등) 설정 가능 |
| 서포트 발동 | 항상 자동 |

**UI 구성**:
- [AUTO] 버튼 (토글)
- 배속 버튼: 1x / 2x / 3x
- 자동 조건 세부 설정 UI 제공 예정

---

### 📱 UI 구성 예시

- **상단**: 적 바몬 정보 (이름, HP 바)
- **중앙**: 전투 필드 (바몬 애니메이션)
- **하단**:
  - 좌우 스와이프 or 버튼으로 교체
  - 스킬 버튼 (2개)
  - 필살기 버튼 (상하 스와이프 or 터치)
  - 서포트 바몬 아이콘 (쿨타임 표시만)

---

### 🎰 룰렛 시스템 상세

- **필살기 룰렛**:
  - 결과 종류: 실패 / 성공 / 대성공(크리)
  - 연출: 회전 → 슬로우 → 멈춤 → 컷인
- **포획 룰렛**:
  - 바몬 소환 or 상대 포획 시 등장
  - 결과에 따라 포획 성공 여부 결정
- **보상 룰렛**:
  - 이벤트/레이드 보상 지급 시 활용 가능

사용 Flutter 패키지:
- `flutter_fortune_wheel` or `custom painter`

---

### 🔧 기술 구조 요약

| 항목 | 설명 |
|------|------|
| 전투 엔진 | 상태 머신 기반 (BattleState: idle → attack → skill → result 등)
| 상태 관리 | `Riverpod` or `Bloc` 권장
| 전투 Tick | `Timer.periodic()` 활용
| UI 전환 | `AnimatedSwitcher`, `AnimatedPositioned` 활용
| 애니메이션 | `Rive`, `flare_flutter`, `Lottie` 활용 가능

---

### 📊 확장 계획

- 상태이상 추가 (중독, 마비, 침묵 등)
- PvP 비동기 리플레이 전투 적용
- 레이드 보스 패턴 기반 공격 시스템 적용 예정

---

### ✅ 테스트 체크리스트

| 항목 | 체크 |
|------|------|
| 바몬 교체 쿨타임 동작 여부 | ✅ |
| 자동 전투 조건 작동 여부 | ✅ |
| 스킬 및 필살기 컷인 정상 출력 | ✅ |
| 룰렛 결과 반영 정확성 | ✅ |
| 서포트 바몬 발동 조건 정상 여부 | ✅ |

---

> *이 문서는 바몬 월드 v1.1 전투 시스템 기획의 기준 버전이며, 이후 업데이트에 따라 확장될 수 있습니다.*

